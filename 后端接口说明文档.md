# 中影AI 实时面容系统 - 后端接口开发说明书 (V1.0)

## 1. 概述
本系统是一套面向中国电影人工智能研究院（CMAI）的实时人像/模型替换系统。后端主要负责资产（人像、模型、场景）的静态管理、系统配置的持久化，以及与 AI 算法引擎（面容替换、模型替换）的桥接通信。

## 2. 核心数据结构定义

### 2.1 资产项 (ThumbnailItem)
```json
{
  "id": "string",
  "name": "string",
  "url": "string (完整HTTP访问路径)"
}
```

---

## 3. 基础资产接口 (Asset APIs)
系统启动及点击刷新按键时调用。

### 3.1 获取人像资产列表 (Face Swap)
*   **接口地址**: `GET /api/assets/portraits`
*   **功能**: 扫描配置中的 `portraitWorkDir` 目录，返回可用的人脸素材列表。
*   **响应**: `Array<ThumbnailItem>`

### 3.2 获取DFM模型列表 (Model Swap)
*   **接口地址**: `GET /api/assets/models`
*   **功能**: 扫描配置中的 `portraitDfmDir` 目录，返回可用的 DFM 模型预览图列表。
*   **响应**: `Array<ThumbnailItem>`

### 3.3 获取场景资产列表
*   **接口地址**: `GET /api/assets/scenes`
*   **功能**: 扫描 `sceneDir` 目录，返回可用的背景图列表。
*   **响应**: `Array<ThumbnailItem>`

---

## 4. 系统配置接口 (Configuration APIs)

### 4.1 获取全量配置
*   **接口地址**: `GET /systemConfig.json` (或 `/api/config`)
*   **功能**: 返回系统初始化的所有参数。

### 4.2 更新系统配置
*   **接口地址**: `POST /api/config/update`
*   **功能**: 接收并保存前端修改的配置项。

---

## 5. AI 逻辑处理接口 (AI Core Control)

### 5.1 实时AI合成控制 (核心处理)
*   **操作**: `POST /api/ai/process`
*   **参数**:
    *   `enable`: `boolean` (开启/停止)
    *   `mode`: `"FACE_SWAP" | "MODEL_SWAP"`
    *   `portrait_id`: `string` (选中的目标 ID)
    *   `similarity`: `number` (0-100)
    *   `sharpness`: `number` (0-100)
*   **业务逻辑**: 
    *   当 `mode` 为 `FACE_SWAP` 时：执行面部特征提取与替换。
    *   当 `mode` 为 `MODEL_SWAP` 时：执行基于 DFM 的全人像生成替换。

### 5.2 无绿幕抠像指令 (AI Matting)
*   **说明**: 本功能已优先在前端实现实时预览。后端接口可作为高精度合成的可选项。
*   **操作**: `POST /api/ai/matting`
*   **参数**: `active`: `boolean`
*   **后端职责**: 当开启时，在视频流输出阶段应用高精度分割模型。

---

## 6. 性能与流控要求
1.  **低延迟**: 指令下发到算法生效的延迟需控制在 **20ms** 以内。
2.  **异步切换**: 在 `FACE_SWAP` 与 `MODEL_SWAP` 切换时，后端应确保输出流的连续性，避免黑屏。

---

**文档说明**: 
前端已实现 `localStorage` 同步机制（用于 Viewer 模式）和 UI 交互逻辑。资产列表显示已与 `mode` 参数绑定。